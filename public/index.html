<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FB Share</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
    <style>
        :root {
            --primary: #1877f2;
            --primary-dark: #166fe5;
            --secondary: #36a420;
            --danger: #f02849;
            --warning: #f7b928;
            --info: #2ab1f0;
            --dark: #1c1e21;
            --light: #f0f2f5;
            --gray: #65676b;
            --gray-light: #e4e6eb;
            --gray-dark: #3a3b3c;
            --card-bg: #ffffff;
            --sidebar-bg: #242526;
            --border: #dadde1;
            --shadow: rgba(0, 0, 0, 0.1);
            --shadow-dark: rgba(0, 0, 0, 0.2);
            --success-gradient: linear-gradient(135deg, #36a420 0%, #2d8c1b 100%);
            --primary-gradient: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            --danger-gradient: linear-gradient(135deg, var(--danger) 0%, #d4203e 100%);
            --animation-speed: 0.3s;
            --border-radius: 16px;
            --border-radius-sm: 10px;
            --border-radius-lg: 24px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            overflow-x: hidden;
            color: var(--dark);
            line-height: 1.6;
        }

        .mobile-container {
            max-width: 500px;
            margin: 0 auto;
            min-height: 100vh;
            background: var(--light);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
        }

        /* Header Styles */
        .header {
            background: var(--primary-gradient);
            color: white;
            padding: 20px 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 20px rgba(24, 119, 242, 0.3);
            position: relative;
            z-index: 100;
            animation: slideDown 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: pulse 2s infinite;
        }

        .logo-text h1 {
            font-size: 22px;
            font-weight: 700;
            letter-spacing: -0.5px;
        }

        .logo-text p {
            font-size: 11px;
            opacity: 0.9;
            font-weight: 300;
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .menu-btn {
            background: rgba(255, 255, 255, 0.15);
            border: none;
            width: 44px;
            height: 44px;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 4px;
            cursor: pointer;
            transition: all var(--animation-speed);
            position: relative;
        }

        .menu-btn:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: scale(1.05) rotate(5deg);
        }

        .menu-btn span {
            width: 20px;
            height: 2.5px;
            background: white;
            border-radius: 2px;
            transition: all var(--animation-speed);
            transform-origin: center;
        }

        .menu-btn.active span:nth-child(1) {
            transform: rotate(45deg) translate(5px, 5px);
        }

        .menu-btn.active span:nth-child(2) {
            opacity: 0;
        }

        .menu-btn.active span:nth-child(3) {
            transform: rotate(-45deg) translate(7px, -6px);
        }

        .user-count {
            background: rgba(255, 255, 255, 0.15);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 8px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .user-count i {
            font-size: 12px;
        }

        /* Sidebar Styles */
        .sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            opacity: 0;
            visibility: hidden;
            transition: all var(--animation-speed);
            backdrop-filter: blur(5px);
        }

        .sidebar-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .sidebar {
            position: fixed;
            top: 0;
            left: -320px;
            width: 300px;
            height: 100%;
            background: var(--sidebar-bg);
            color: white;
            z-index: 1000;
            transition: left 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            box-shadow: 5px 0 30px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
        }

        .sidebar.active {
            left: 0;
        }

        .sidebar-header {
            padding: 30px 25px;
            background: rgba(0, 0, 0, 0.2);
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-header h2 {
            font-size: 22px;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
        }

        .sidebar-header h2 i {
            color: var(--primary);
        }

        .close-sidebar {
            position: absolute;
            top: 25px;
            right: 25px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--animation-speed);
        }

        .close-sidebar:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: rotate(90deg);
        }

        .sidebar-menu {
            flex: 1;
            padding: 20px 0;
            overflow-y: auto;
        }

        .menu-item {
            padding: 18px 25px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all var(--animation-speed);
            border-left: 4px solid transparent;
            margin: 5px 0;
            position: relative;
            overflow: hidden;
        }

        .menu-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s;
        }

        .menu-item:hover::before {
            left: 100%;
        }

        .menu-item:hover {
            background: rgba(255, 255, 255, 0.05);
            border-left: 4px solid var(--primary);
            padding-left: 30px;
        }

        .menu-item.active {
            background: rgba(24, 119, 242, 0.15);
            border-left: 4px solid var(--primary);
        }

        .menu-item i {
            font-size: 20px;
            width: 24px;
            text-align: center;
            color: rgba(255, 255, 255, 0.8);
        }

        .menu-item.active i {
            color: var(--primary);
        }

        .menu-item span {
            font-size: 16px;
            font-weight: 500;
        }

        .menu-badge {
            margin-left: auto;
            background: var(--primary);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        /* Main Content Styles */
        .content {
            padding: 25px;
            animation: fadeIn 0.5s ease-out;
        }

        .content-section {
            display: none;
            animation: slideUp 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55);
        }

        .content-section.active {
            display: block;
        }

        /* Form Container */
        .form-container {
            background: var(--card-bg);
            border-radius: var(--border-radius-lg);
            padding: 30px;
            box-shadow: 0 10px 40px var(--shadow);
            margin-bottom: 25px;
            border: 1px solid var(--border);
            transform: translateY(0);
            transition: transform var(--animation-speed);
        }

        .form-container:hover {
            transform: translateY(-5px);
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--light);
        }

        .section-icon {
            width: 50px;
            height: 50px;
            background: var(--primary-gradient);
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 22px;
            box-shadow: 0 5px 15px rgba(24, 119, 242, 0.3);
        }

        .section-title h2 {
            font-size: 24px;
            color: var(--dark);
            font-weight: 700;
        }

        .section-title p {
            font-size: 14px;
            color: var(--gray);
            margin-top: 5px;
        }

        /* Form Elements */
        .form-group {
            margin-bottom: 25px;
        }

        .form-label {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 12px;
            color: var(--dark);
            font-weight: 600;
            font-size: 15px;
        }

        .form-label i {
            color: var(--primary);
            width: 20px;
        }

        .form-control {
            width: 100%;
            padding: 18px 20px;
            border: 2px solid var(--gray-light);
            border-radius: var(--border-radius);
            font-size: 16px;
            transition: all var(--animation-speed);
            background: var(--light);
            font-family: 'Poppins', sans-serif;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(24, 119, 242, 0.1);
            background: white;
        }

        textarea.form-control {
            min-height: 120px;
            resize: vertical;
            line-height: 1.5;
        }

        .form-control::placeholder {
            color: var(--gray);
            opacity: 0.7;
        }

        .input-with-icon {
            position: relative;
        }

        .input-icon {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--gray);
            font-size: 18px;
        }

        .input-with-icon .form-control {
            padding-left: 55px;
        }

        .form-hint {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-top: 10px;
            font-size: 13px;
            color: var(--gray);
            background: var(--light);
            padding: 10px 15px;
            border-radius: var(--border-radius-sm);
            border-left: 3px solid var(--info);
        }

        .form-hint i {
            color: var(--info);
        }

        /* Buttons */
        .btn {
            width: 100%;
            padding: 18px;
            border: none;
            border-radius: var(--border-radius);
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--animation-speed);
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 12px;
            font-family: 'Poppins', sans-serif;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: var(--primary-gradient);
            color: white;
            box-shadow: 0 6px 20px rgba(24, 119, 242, 0.4);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(24, 119, 242, 0.5);
        }

        .btn-primary:active:not(:disabled) {
            transform: translateY(-1px);
        }

        .btn-danger {
            background: var(--danger-gradient);
            color: white;
            box-shadow: 0 6px 20px rgba(240, 40, 73, 0.4);
        }

        .btn-danger:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(240, 40, 73, 0.5);
        }

        .btn-success {
            background: var(--success-gradient);
            color: white;
            box-shadow: 0 6px 20px rgba(54, 164, 32, 0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        /* Progress Section */
        .progress-container {
            background: var(--card-bg);
            border-radius: var(--border-radius-lg);
            padding: 30px;
            box-shadow: 0 10px 40px var(--shadow);
            margin-bottom: 25px;
            border: 1px solid var(--border);
        }

        .progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .progress-title {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .progress-title i {
            font-size: 24px;
            color: var(--primary);
        }

        .progress-title h3 {
            font-size: 22px;
            color: var(--dark);
            font-weight: 700;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            background: var(--light);
            border-radius: 20px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--secondary);
            animation: pulse 1.5s infinite;
        }

        .status-dot.stopped {
            background: var(--danger);
            animation: none;
        }

        .status-dot.completed {
            background: var(--secondary);
            animation: none;
        }

        #statusText {
            font-weight: 600;
            font-size: 14px;
        }

        .progress-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--light) 0%, #e4e6eb 100%);
            padding: 25px 20px;
            border-radius: var(--border-radius);
            text-align: center;
            transition: all var(--animation-speed);
            border: 1px solid var(--border);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--primary-gradient);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px var(--shadow);
        }

        .stat-card .value {
            font-size: 36px;
            font-weight: 800;
            color: var(--primary);
            margin-bottom: 8px;
            line-height: 1;
        }

        .stat-card .label {
            font-size: 13px;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 1.2px;
            font-weight: 600;
        }

        .progress-bar-container {
            margin: 40px 0;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-size: 15px;
            color: var(--gray);
            font-weight: 500;
        }

        .progress-bar {
            height: 16px;
            background: var(--light);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            border: 1px solid var(--border);
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: 10px;
            width: 0%;
            transition: width 0.8s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            position: relative;
            overflow: hidden;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(255, 255, 255, 0.4) 50%, 
                transparent 100%);
            animation: shimmer 2s infinite;
        }

        /* History Section */
        .history-container {
            background: var(--card-bg);
            border-radius: var(--border-radius-lg);
            padding: 30px;
            box-shadow: 0 10px 40px var(--shadow);
            border: 1px solid var(--border);
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .history-title {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .history-title i {
            font-size: 24px;
            color: var(--primary);
        }

        .history-title h3 {
            font-size: 22px;
            color: var(--dark);
            font-weight: 700;
        }

        .history-controls {
            display: flex;
            gap: 10px;
        }

        .icon-btn {
            background: var(--light);
            border: none;
            width: 44px;
            height: 44px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all var(--animation-speed);
            color: var(--dark);
            font-size: 18px;
        }

        .icon-btn:hover {
            background: var(--primary);
            color: white;
            transform: scale(1.1);
        }

        .icon-btn.refresh:hover {
            transform: rotate(180deg);
        }

        .history-list {
            max-height: 500px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .history-list::-webkit-scrollbar {
            width: 6px;
        }

        .history-list::-webkit-scrollbar-track {
            background: var(--light);
            border-radius: 10px;
        }

        .history-list::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }

        .history-item {
            background: var(--light);
            padding: 20px;
            border-radius: var(--border-radius);
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all var(--animation-speed);
            border-left: 4px solid var(--primary);
            position: relative;
            overflow: hidden;
        }

        .history-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.6s;
        }

        .history-item:hover::before {
            left: 100%;
        }

        .history-item:hover {
            transform: translateX(10px);
            box-shadow: 0 8px 25px var(--shadow);
        }

        .history-info {
            flex: 1;
            min-width: 0;
        }

        .history-url {
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 8px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            font-size: 15px;
        }

        .history-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            font-size: 12px;
            color: var(--gray);
        }

        .history-meta span {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .history-count {
            background: var(--primary);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 700;
            min-width: 80px;
            text-align: center;
            font-size: 14px;
            box-shadow: 0 4px 12px rgba(24, 119, 242, 0.3);
        }

        .empty-history {
            text-align: center;
            padding: 60px 20px;
            color: var(--gray);
        }

        .empty-history i {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .empty-history p {
            font-size: 16px;
            font-weight: 500;
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 25px;
            right: 25px;
            z-index: 9999;
            max-width: 350px;
            pointer-events: none;
        }

        .toast {
            background: var(--card-bg);
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: flex-start;
            gap: 15px;
            transform: translateX(400px);
            opacity: 0;
            transition: all 0.6s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            border-left: 4px solid var(--primary);
            pointer-events: auto;
            backdrop-filter: blur(10px);
        }

        .toast.show {
            transform: translateX(0);
            opacity: 1;
        }

        .toast.hide {
            transform: translateX(400px);
            opacity: 0;
        }

        .toast-icon {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
            flex-shrink: 0;
        }

        .toast.success .toast-icon {
            background: var(--success-gradient);
        }

        .toast.error .toast-icon {
            background: var(--danger-gradient);
        }

        .toast.warning .toast-icon {
            background: linear-gradient(135deg, var(--warning) 0%, #e6a500 100%);
        }

        .toast.info .toast-icon {
            background: linear-gradient(135deg, var(--info) 0%, #1a9ed8 100%);
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: 700;
            color: var(--dark);
            margin-bottom: 6px;
            font-size: 16px;
        }

        .toast-message {
            font-size: 14px;
            color: var(--gray);
            line-height: 1.5;
        }

        .toast-close {
            background: none;
            border: none;
            color: var(--gray);
            cursor: pointer;
            font-size: 18px;
            padding: 5px;
            margin-left: 10px;
            opacity: 0.7;
            transition: opacity var(--animation-speed);
            flex-shrink: 0;
        }

        .toast-close:hover {
            opacity: 1;
        }

        /* Animations */
        @keyframes slideDown {
            from {
                transform: translateY(-100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes slideUp {
            from {
                transform: translateY(30px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.1);
                opacity: 0.8;
            }
        }

        @keyframes shimmer {
            0% {
                transform: translateX(-100%);
            }
            100% {
                transform: translateX(100%);
            }
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-10px);
            }
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        /* Guide Section */
        .guide-container {
            background: var(--card-bg);
            border-radius: var(--border-radius-lg);
            padding: 30px;
            box-shadow: 0 10px 40px var(--shadow);
            margin-bottom: 25px;
            border: 1px solid var(--border);
        }

        .guide-step {
            background: var(--light);
            padding: 25px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            border-left: 4px solid var(--primary);
            transition: all var(--animation-speed);
        }

        .guide-step:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 20px var(--shadow);
        }

        .guide-step-number {
            width: 40px;
            height: 40px;
            background: var(--primary);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 18px;
            margin-bottom: 15px;
        }

        .guide-step h4 {
            font-size: 18px;
            color: var(--dark);
            margin-bottom: 10px;
            font-weight: 600;
        }

        .guide-step p {
            color: var(--gray);
            font-size: 14px;
            line-height: 1.6;
        }

        .code-block {
            background: var(--sidebar-bg);
            color: #f8f8f2;
            padding: 15px;
            border-radius: var(--border-radius-sm);
            font-family: 'Courier New', monospace;
            font-size: 13px;
            margin-top: 10px;
            overflow-x: auto;
            border-left: 3px solid var(--primary);
        }

        /* Responsive Design */
        @media (max-width: 500px) {
            .mobile-container {
                border-radius: 0;
                box-shadow: none;
            }
            
            .content {
                padding: 20px;
            }
            
            .form-container,
            .progress-container,
            .history-container,
            .guide-container {
                padding: 25px;
            }
            
            .progress-stats {
                grid-template-columns: 1fr;
            }
            
            .section-header {
                flex-direction: column;
                text-align: center;
                gap: 15px;
            }
            
            .section-icon {
                width: 60px;
                height: 60px;
                font-size: 24px;
            }
            
            .history-meta {
                flex-direction: column;
                gap: 8px;
            }
            
            .toast-container {
                top: 15px;
                right: 15px;
                left: 15px;
                max-width: none;
            }
        }

        @media (max-width: 350px) {
            .header {
                padding: 15px;
            }
            
            .logo-text h1 {
                font-size: 18px;
            }
            
            .content {
                padding: 15px;
            }
            
            .form-container,
            .progress-container,
            .history-container,
            .guide-container {
                padding: 20px;
            }
        }

        /* Quick Actions */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-top: 25px;
        }

        .quick-action-btn {
            background: var(--light);
            border: 2px solid var(--border);
            padding: 20px;
            border-radius: var(--border-radius);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: all var(--animation-speed);
            text-align: center;
        }

        .quick-action-btn:hover {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(24, 119, 242, 0.3);
        }

        .quick-action-btn:hover i,
        .quick-action-btn:hover span {
            color: white;
        }

        .quick-action-btn i {
            font-size: 28px;
            color: var(--primary);
            transition: all var(--animation-speed);
        }

        .quick-action-btn span {
            font-weight: 600;
            font-size: 14px;
            color: var(--dark);
            transition: all var(--animation-speed);
        }

        /* ==================== DAGDAG: User Activity Indicator ==================== */
        .user-activity-indicator {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 12px;
            color: rgba(255, 255, 255, 0.8);
        }

        .activity-pulse {
            width: 8px;
            height: 8px;
            background-color: #36a420;
            border-radius: 50%;
            animation: activityPulse 2s infinite;
        }

        @keyframes activityPulse {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.3);
                opacity: 0.7;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .user-stats-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin: 20px 0;
        }

        .user-stat-item {
            background: var(--light);
            padding: 15px;
            border-radius: var(--border-radius-sm);
            text-align: center;
            border: 1px solid var(--border);
        }

        .user-stat-label {
            font-size: 11px;
            color: var(--gray);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 5px;
        }

        .user-stat-value {
            font-size: 18px;
            font-weight: 700;
            color: var(--primary);
        }
 
        .user-list-container {
            max-height: 400px;
            overflow-y: auto;
            margin-top: 20px;
            border: 1px solid var(--border);
            border-radius: var(--border-radius);
            background: var(--light);
        }

        .user-list-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            border-bottom: 1px solid var(--border);
            transition: all var(--animation-speed);
        }

        .user-list-item:hover {
            background: white;
        }

        .user-list-item:last-child {
            border-bottom: none;
        }

        .user-info {
            flex: 1;
        }

        .user-ip {
            font-weight: 600;
            color: var(--dark);
            font-size: 14px;
            margin-bottom: 3px;
        }

        .user-agent {
            font-size: 11px;
            color: var(--gray);
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            max-width: 200px;
        }

        .user-status {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-badge {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 10px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .status-badge.active {
            background: #36a420;
            color: white;
        }

        .status-badge.inactive {
            background: var(--gray);
            color: white;
        }

        .last-seen {
            font-size: 11px;
            color: var(--gray);
        }
    </style>
</head>
<body>
    <div class="mobile-container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fab fa-facebook-f"></i>
                </div>
                <div class="logo-text">
                    <h1>FB Share</h1>
                    <p>Professional Sharing Tool</p>
                </div>
            </div>
            <div class="header-controls">
                <div class="user-count">
                    <i class="fas fa-users"></i>
                    <span id="userCount">1</span>
                    <!-- ==================== DAGDAG: Activity Indicator ==================== -->
                    <div class="user-activity-indicator" id="userActivityIndicator" style="display: none;">
                        <div class="activity-pulse"></div>
                        <span id="veryActiveCount">0</span>
                    </div>
                </div>
                <button class="menu-btn" id="menuBtn">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
            </div>
        </header>

        <!-- Sidebar -->
        <div class="sidebar-overlay" id="sidebarOverlay"></div>
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2><i class="fas fa-bars"></i> Navigation</h2>
                <button class="close-sidebar" id="closeSidebar">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="sidebar-menu">
                <div class="menu-item active" data-section="dashboard">
                    <i class="fas fa-home"></i>
                    <span>Dashboard</span>
                    <span class="menu-badge">Home</span>
                </div>
                <div class="menu-item" data-section="progress">
                    <i class="fas fa-chart-line"></i>
                    <span>Live Progress</span>
                    <span class="menu-badge" id="progressBadge">0</span>
                </div>
                <div class="menu-item" data-section="history">
                    <i class="fas fa-history"></i>
                    <span>History</span>
                    <span class="menu-badge" id="historyBadge">0</span>
                </div>
                <div class="menu-item" data-section="guide">
                    <i class="fas fa-book"></i>
                    <span>Guide</span>
                    <span class="menu-badge">Help</span>
                </div>
                <div class="menu-item" data-section="users">
                    <i class="fas fa-users"></i>
                    <span>Multi Users</span>
                    <span class="menu-badge" id="usersBadge">1</span>
                </div>
 
                <div class="menu-item" data-section="userStats">
                    <i class="fas fa-chart-pie"></i>
                    <span>User Statistics</span>
                    <span class="menu-badge">New</span>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="content">
            <section class="content-section active" id="dashboardSection">
                <div class="form-container">
    <div class="section-header">
        <div class="section-icon share-arrow">
            <i class="fas fa-share" style="font-size: 24px;"></i>
        </div>
        <div class="section-title">
            <h2>Facebook Share</h2>
            <p>Share Facebook posts automatically</p>
        </div>
    </div>
                    
                   <form id="shareForm">
                        <div class="form-group">
                            <label class="form-label" for="cookie">
                                <i class="fas fa-cookie-bite"></i>
                                Facebook Cookie
                            </label>
                            <div class="input-with-icon">
                                <i class="input-icon fas fa-key"></i>
                                <textarea 
                                    class="form-control" 
                                    id="cookie" 
                                    placeholder='[{"key": "sb", "value": "..."}, {"key": "c_user", "value": "..."}, ...]'
                                    rows="4"
                                    required></textarea>
                            </div>
                            <div class="form-hint">
                                <i class="fas fa-info-circle"></i>
                                Get cookies from Facebook after login. Format must be valid JSON array.
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="url">
                                <i class="fas fa-link"></i>
                                Post URL
                            </label>
                            <div class="input-with-icon">
                                <i class="input-icon fas fa-globe"></i>
                                <input 
                                    type="url" 
                                    class="form-control" 
                                    id="url" 
                                    placeholder="https://www.facebook.com/username/posts/123456789"
                                    required>
                            </div>
                            <div class="form-hint">
                                <i class="fas fa-exclamation-triangle"></i>
                                Make sure the post is public or visible to you
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="amount">
                                <i class="fas fa-bullseye"></i>
                                Target Shares
                            </label>
                            <div class="input-with-icon">
                                <i class="input-icon fas fa-hashtag"></i>
                                <input 
                                    type="number" 
                                    class="form-control" 
                                    id="amount" 
                                    placeholder="e.g., 100"
                                    min="1"
                                    max="10000"
                                    required>
                            </div>
                            <div class="form-hint">
                                <i class="fas fa-infinity"></i>
                                No limit sharing - Enter any number you want
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label" for="interval">
                                <i class="fas fa-clock"></i>
                                Interval (seconds)
                            </label>
                            <div class="input-with-icon">
                                <i class="input-icon fas fa-stopwatch"></i>
                                <input 
                                    type="number" 
                                    class="form-control" 
                                    id="interval" 
                                    value="1"
                                    min="1"
                                    max="60"
                                    required>
                            </div>
                            <div class="form-hint">
                                <i class="fas fa-bolt"></i>
                                1 second delay between shares for maximum speed
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary" id="submitBtn">
                            <i class="fas fa-play"></i>
                            <span>Start Sharing Process</span>
                        </button>
                    </form>
                </div>

                <div class="quick-actions">
                    <div class="quick-action-btn" id="quickProgress">
                        <i class="fas fa-chart-line"></i>
                        <span>View Progress</span>
                    </div>
                    <div class="quick-action-btn" id="quickHistory">
                        <i class="fas fa-history"></i>
                        <span>Check History</span>
                    </div>
                    <div class="quick-action-btn" id="quickGuide">
                        <i class="fas fa-book"></i>
                        <span>Read Guide</span>
                    </div>
                    <div class="quick-action-btn" id="quickUsers">
                        <i class="fas fa-users"></i>
                        <span>Multi Users</span>
                    </div>
        
                    <div class="quick-action-btn" id="quickUserStats">
                        <i class="fas fa-chart-pie"></i>
                        <span>User Stats</span>
                    </div>
                    <div class="quick-action-btn" id="quickRealTime">
                        <i class="fas fa-broadcast-tower"></i>
                        <span>Real-time</span>
                    </div>
                </div>
            </section>

            <!-- Progress Section -->
            <section class="content-section" id="progressSection">
                <div class="progress-container">
                    <div class="progress-header">
                        <div class="progress-title">
                            <i class="fas fa-chart-line"></i>
                            <h3>Live Progress Monitor</h3>
                        </div>
                        <div class="status-indicator">
                            <span class="status-dot" id="statusDot"></span>
                            <span id="statusText">Ready</span>
                        </div>
                    </div>

                    <div class="progress-stats">
                        <div class="stat-card">
                            <div class="value" id="currentShares">0</div>
                            <div class="label">Current Shares</div>
                        </div>
                        <div class="stat-card">
                            <div class="value" id="targetShares">0</div>
                            <div class="label">Target Shares</div>
                        </div>
                        <div class="stat-card">
                            <div class="value" id="progressPercent">0%</div>
                            <div class="label">Progress</div>
                        </div>
                        <div class="stat-card">
                            <div class="value" id="timeRemaining">0s</div>
                            <div class="label">Time Remaining</div>
                        </div>
                    </div>

                    <div class="progress-bar-container">
                        <div class="progress-info">
                            <span>Sharing Progress</span>
                            <span id="progressText">0/0</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                    </div>

                    <div class="form-group" style="margin-top: 30px;">
                        <div class="input-with-icon">
                            <i class="input-icon fas fa-id-card"></i>
                            <input 
                                type="number" 
                                class="form-control" 
                                id="sessionIdInput" 
                                placeholder="Enter Session ID to monitor"
                                min="1">
                        </div>
                        <div class="form-hint" style="margin-top: 10px;">
                            <i class="fas fa-info-circle"></i>
                            Enter the Session ID you received when starting sharing
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 25px;">
                        <button class="btn btn-primary" id="monitorBtn">
                            <i class="fas fa-search"></i>
                            <span>Monitor Session</span>
                        </button>
                        <button class="btn btn-danger" id="stopBtn">
                            <i class="fas fa-stop"></i>
                            <span>Stop Process</span>
                        </button>
                    </div>
                </div>
            </section>

            <!-- History Section -->
            <section class="content-section" id="historySection">
                <div class="history-container">
                    <div class="history-header">
                        <div class="history-title">
                            <i class="fas fa-history"></i>
                            <h3>Sharing History</h3>
                        </div>
                        <div class="history-controls">
                            <button class="icon-btn refresh" id="refreshHistory" title="Refresh History">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                            <button class="icon-btn" id="clearHistory" title="Clear All History">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    <div class="history-list" id="historyList">
                        <div class="empty-history">
                            <i class="fas fa-history"></i>
                            <p>No sharing history yet</p>
                            <p style="font-size: 14px; margin-top: 10px; opacity: 0.7;">
                                Start sharing to see your history here
                            </p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Guide Section -->
            <section class="content-section" id="guideSection">
                <div class="guide-container">
                    <div class="section-header">
                        <div class="section-icon">
                            <i class="fas fa-book"></i>
                        </div>
                        <div class="section-title">
                            <h2>Complete User Guide</h2>
                            <p>Step-by-step instructions to use FB Share Pro</p>
                        </div>
                    </div>

                    <div class="guide-step">
                        <div class="guide-step-number">1</div>
                        <h4>Get Facebook Cookies </h4>
                        <p>You need to get your Facebook cookies to use this tool:</p>
                        <div class="code-block">
1. I-download ang browser na ito: 
   <a href="https://kiwi-browser.en.uptodown.com/android/download" target="_blank">kiwi browser</a>

2. Buksan ang browser pagkatapos ma-download.

3. Pumunta sa Facebook gamit ang browser at mag-login sa account na gusto mong kunan ng appstate.

4. Pindutin ang tatlong tuldok sa taas: 

5. Hanapin ang Extensions at i-click ang +(from store). Sa search bar, i-type ang: c3c fbstate utility

6. Kapag lumabas, i-click ito. Sa kanan, pindutin ang Add to Chrome at maghintay hanggang ma-install.

7. Pagkatapos ma-install, i-click muli ang tatlong tuldok , scroll pababa, at makikita mo ang C3C FBSTATE.

8. I-click ito, pagkatapos Copy to Clipboard ang iyong appstate.

</div>
                    </div>

                    <div class="guide-step">
                        <div class="guide-step-number">2</div>
                        <h4>Find Post URL</h4>
                        <p>Go to the Facebook post you want to share and copy its URL:</p>
                        <div class="code-block">
https://www.facebook.com/username/posts/123456789<br>
OR<br>
https://m.facebook.com/story.php?story_fbid=123456789
                        </div>
                    </div>

                    <div class="guide-step">
                        <div class="guide-step-number">3</div>
                        <h4>Set Sharing Parameters</h4>
                        <p>Enter the required information in the form:</p>
                        <ul style="color: var(--gray); font-size: 14px; line-height: 1.6; padding-left: 20px; margin-top: 10px;">
                            <li><strong>Cookies:</strong> Your Facebook cookies in JSON format</li>
                            <li><strong>URL:</strong> The Facebook post URL</li>
                            <li><strong>Target Shares:</strong> Number of shares you want (no limit)</li>
                            <li><strong>Interval:</strong> Delay between shares (1 second recommended)</li>
                        </ul>
                    </div>

                    <div class="guide-step">
                        <div class="guide-step-number">4</div>
                        <h4>Monitor Progress</h4>
                        <p>After starting, you can monitor the progress in real-time:</p>
                        <ul style="color: var(--gray); font-size: 14px; line-height: 1.6; padding-left: 20px; margin-top: 10px;">
                            <li>View live progress bar</li>
                            <li>Check current shares count</li>
                            <li>See time remaining</li>
                            <li>Monitor multiple sessions</li>
                        </ul>
                    </div>

                    <div class="guide-step">
                        <div class="guide-step-number">5</div>
                        <h4>View History</h4>
                        <p>All your sharing sessions are saved in history:</p>
                        <ul style="color: var(--gray); font-size: 14px; line-height: 1.6; padding-left: 20px; margin-top: 10px;">
                            <li>See all past sessions</li>
                            <li>Check success/failure status</li>
                            <li>Monitor progress percentages</li>
                            <li>Track multiple users</li>
                        </ul>
                    </div>

                    <button class="btn btn-primary" onclick="showSection('dashboard')" style="margin-top: 20px;">
                        <i class="fas fa-rocket"></i>
                        <span>Start Sharing Now</span>
                    </button>
                </div>
            </section>

            <!-- Users Section -->
            <section class="content-section" id="usersSection">
                <div class="form-container">
                    <div class="section-header">
                        <div class="section-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="section-title">
                            <h2>Multi-User System</h2>
                            <p>Support for multiple concurrent users</p>
                        </div>
                    </div>

                    <div class="progress-stats">
                        <div class="stat-card">
                            <div class="value" id="activeUsersCount">1</div>
                            <div class="label">Active Users</div>
                        </div>
                        <div class="stat-card">
                            <div class="value" id="totalSessionsCount">0</div>
                            <div class="label">Total Sessions</div>
                        </div>
                        <div class="stat-card">
                            <div class="value" id="activeSessionsCount">0</div>
                            <div class="label">Active Sessions</div>
                        </div>
                        <div class="stat-card">
                            <div class="value" id="completedSessionsCount">0</div>
                            <div class="label">Completed</div>
                        </div>
                    </div>

                    
                    <div class="user-stats-grid" id="userStatsGrid" style="display: none;">
                        <div class="user-stat-item">
                            <div class="user-stat-label">Unique IPs</div>
                            <div class="user-stat-value" id="uniqueIPsCount">0</div>
                        </div>
                        <div class="user-stat-item">
                            <div class="user-stat-label">Very Active</div>
                            <div class="user-stat-value" id="veryActiveUsersCount">0</div>
                        </div>
                        <div class="user-stat-item">
                            <div class="user-stat-label">Total Req</div>
                            <div class="user-stat-value" id="totalRequestsCount">0</div>
                        </div>
                        <div class="user-stat-item">
                            <div class="user-stat-label">Tracked</div>
                            <div class="user-stat-value" id="totalTrackedCount">0</div>
                        </div>
                    </div>

                    <div class="form-hint" style="margin: 25px 0;">
                        <i class="fas fa-info-circle"></i>
                        This system supports unlimited concurrent users. Each user can run multiple sharing sessions simultaneously.
                    </div>

                    <h3 style="margin: 30px 0 20px 0; color: var(--dark); font-size: 18px;">
                        <i class="fas fa-user-plus"></i> Add New User Session
                    </h3>

                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-user"></i>
                            User Cookies
                        </label>
                        <textarea 
                            class="form-control" 
                            id="multiUserCookie" 
                            placeholder='Paste user cookies here...'
                            rows="3"></textarea>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <button class="btn btn-success" id="addUserBtn">
                            <i class="fas fa-user-plus"></i>
                            <span>Add User</span>
                        </button>
                        <button class="btn btn-primary" onclick="showSection('dashboard')">
                            <i class="fas fa-share-alt"></i>
                            <span>Start Sharing</span>
                        </button> 
                        
                        <button class="btn btn-info" id="viewDetailedBtn" style="grid-column: span 2;">
                            <i class="fas fa-list"></i>
                            <span>View Detailed User List</span>
                        </button>
                    </div>

                    
                    <div class="user-list-container" id="detailedUserList" style="display: none;">
                    </div>
                </div>
            </section>
 
            <section class="content-section" id="userStatsSection">
                <div class="form-container">
                    <div class="section-header">
                        <div class="section-icon">
                            <i class="fas fa-chart-pie"></i>
                        </div>
                        <div class="section-title">
                            <h2>Real-Time User Statistics</h2>
                            <p>Live tracking of active users and their activities</p>
                        </div>
                    </div>

                    <div class="progress-stats">
                        <div class="stat-card">
                            <div class="value" id="statsActiveUsers">1</div>
                            <div class="label">Active Users</div>
                        </div>
                        <div class="stat-card">
                            <div class="value" id="statsVeryActive">0</div>
                            <div class="label">Very Active</div>
                        </div>
                        <div class="stat-card">
                            <div class="value" id="statsUniqueIPs">1</div>
                            <div class="label">Unique IPs</div>
                        </div>
                        <div class="stat-card">
                            <div class="value" id="statsTotalRequests">0</div>
                            <div class="label">Total Requests</div>
                        </div>
                    </div>

                    <div class="form-hint" style="margin: 20px 0;">
                        <i class="fas fa-info-circle"></i>
                        Real user tracking system - updates every 10 seconds. Users are considered active if they made a request in the last 2 minutes.
                    </div>

                    <div class="form-group">
                        <div class="input-with-icon">
                            <i class="input-icon fas fa-sync-alt"></i>
                            <input type="number" class="form-control" id="refreshInterval" value="10" min="1" max="60">
                        </div>
                        <div class="form-hint">
                            <i class="fas fa-clock"></i>
                            Auto-refresh interval in seconds (1-60)
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 20px;">
                        <button class="btn btn-primary" id="startLiveStatsBtn">
                            <i class="fas fa-play"></i>
                            <span>Start Live Updates</span>
                        </button>
                        <button class="btn btn-secondary" id="stopLiveStatsBtn">
                            <i class="fas fa-stop"></i>
                            <span>Stop Live Updates</span>
                        </button>
                    </div>

                    <div style="margin-top: 30px; padding: 20px; background: var(--light); border-radius: var(--border-radius); text-align: center;">
                        <h4 style="margin-bottom: 15px; color: var(--dark);">
                            <i class="fas fa-chart-line"></i> Live User Activity Chart
                        </h4>
                        <div style="height: 200px; display: flex; align-items: center; justify-content: center; color: var(--gray);">
                            <div>
                                <i class="fas fa-chart-bar" style="font-size: 48px; opacity: 0.3; margin-bottom: 10px;"></i>
                                <p>Live chart will be displayed here</p>
                                <p style="font-size: 12px; margin-top: 5px;">
                                    Showing real-time user count fluctuations
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <script>
        
        const state = {
            activeSessionId: null,
            isSharing: false,
            currentProgress: {
                current: 0,
                target: 0,
                percent: 0,
                timeLeft: 0,
                status: 'ready'
            },
            userCount: 1,
            userStats: {
                activeUsers: 1,
                veryActive: 0,
                uniqueIPs: 1,
                totalRequests: 0,
                totalTracked: 0,
                lastUpdated: Date.now()
            },
            userId: null,
            pollingInterval: null,
            sessionMonitorInterval: null,
            userStatsInterval: null,
            heartbeatInterval: null
        };

        
        const elements = {
            // Menu Elements
            menuBtn: document.getElementById('menuBtn'),
            closeSidebar: document.getElementById('closeSidebar'),
            sidebar: document.getElementById('sidebar'),
            sidebarOverlay: document.getElementById('sidebarOverlay'),
            menuItems: document.querySelectorAll('.menu-item'),
            
            // Section Elements
            sections: {
                dashboard: document.getElementById('dashboardSection'),
                progress: document.getElementById('progressSection'),
                history: document.getElementById('historySection'),
                guide: document.getElementById('guideSection'),
                users: document.getElementById('usersSection'),
                userStats: document.getElementById('userStatsSection') // DAGDAG: New section
            },
            
            // Form Elements
            shareForm: document.getElementById('shareForm'),
            submitBtn: document.getElementById('submitBtn'),
            
            // Progress Elements
            currentShares: document.getElementById('currentShares'),
            targetShares: document.getElementById('targetShares'),
            progressPercent: document.getElementById('progressPercent'),
            timeRemaining: document.getElementById('timeRemaining'),
            progressText: document.getElementById('progressText'),
            progressFill: document.getElementById('progressFill'),
            statusDot: document.getElementById('statusDot'),
            statusText: document.getElementById('statusText'),
            sessionIdInput: document.getElementById('sessionIdInput'),
            monitorBtn: document.getElementById('monitorBtn'),
            stopBtn: document.getElementById('stopBtn'),
            
            // History Elements
            historyList: document.getElementById('historyList'),
            refreshHistoryBtn: document.getElementById('refreshHistory'),
            clearHistoryBtn: document.getElementById('clearHistory'),
            
            // User Elements
            userCountEl: document.getElementById('userCount'),
            activeUsersCount: document.getElementById('activeUsersCount'),
            totalSessionsCount: document.getElementById('totalSessionsCount'),
            activeSessionsCount: document.getElementById('activeSessionsCount'),
            completedSessionsCount: document.getElementById('completedSessionsCount'),
            
            // DAGDAG: New User Stats Elements
            userActivityIndicator: document.getElementById('userActivityIndicator'),
            veryActiveCount: document.getElementById('veryActiveCount'),
            uniqueIPsCount: document.getElementById('uniqueIPsCount'),
            veryActiveUsersCount: document.getElementById('veryActiveUsersCount'),
            totalRequestsCount: document.getElementById('totalRequestsCount'),
            totalTrackedCount: document.getElementById('totalTrackedCount'),
            userStatsGrid: document.getElementById('userStatsGrid'),
            detailedUserList: document.getElementById('detailedUserList'),
            viewDetailedBtn: document.getElementById('viewDetailedBtn'),
            
            // DAGDAG: User Stats Section Elements
            statsActiveUsers: document.getElementById('statsActiveUsers'),
            statsVeryActive: document.getElementById('statsVeryActive'),
            statsUniqueIPs: document.getElementById('statsUniqueIPs'),
            statsTotalRequests: document.getElementById('statsTotalRequests'),
            refreshInterval: document.getElementById('refreshInterval'),
            startLiveStatsBtn: document.getElementById('startLiveStatsBtn'),
            stopLiveStatsBtn: document.getElementById('stopLiveStatsBtn'),
            
            // Badges
            progressBadge: document.getElementById('progressBadge'),
            historyBadge: document.getElementById('historyBadge'),
            usersBadge: document.getElementById('usersBadge'),
            
            // Quick Actions
            quickProgress: document.getElementById('quickProgress'),
            quickHistory: document.getElementById('quickHistory'),
            quickGuide: document.getElementById('quickGuide'),
            quickUsers: document.getElementById('quickUsers'),
            quickUserStats: document.getElementById('quickUserStats'), // DAGDAG: New
            quickRealTime: document.getElementById('quickRealTime'), // DAGDAG: New
            
            // Toast Container
            toastContainer: document.getElementById('toastContainer')
        };

        // ====================
        // TOAST SYSTEM
        // ====================
        class Toast {
            static show(title, message, type = 'info', duration = 5000) {
                const toast = document.createElement('div');
                toast.className = `toast ${type}`;
                
                const icons = {
                    success: 'fa-check-circle',
                    error: 'fa-exclamation-circle',
                    warning: 'fa-exclamation-triangle',
                    info: 'fa-info-circle'
                };
                
                toast.innerHTML = `
                    <div class="toast-icon">
                        <i class="fas ${icons[type]}"></i>
                    </div>
                    <div class="toast-content">
                        <div class="toast-title">${title}</div>
                        <div class="toast-message">${message}</div>
                    </div>
                    <button class="toast-close">
                        <i class="fas fa-times"></i>
                    </button>
                `;
                
                elements.toastContainer.appendChild(toast);
                
                // Show animation
                setTimeout(() => toast.classList.add('show'), 10);
                
                // Close button
                const closeBtn = toast.querySelector('.toast-close');
                closeBtn.addEventListener('click', () => {
                    toast.classList.remove('show');
                    setTimeout(() => toast.remove(), 300);
                });
                
                // Auto remove
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.classList.remove('show');
                        setTimeout(() => toast.remove(), 300);
                    }
                }, duration);
                
                return toast;
            }
            
            static success(title, message, duration) {
                return this.show(title, message, 'success', duration);
            }
            
            static error(title, message, duration) {
                return this.show(title, message, 'error', duration);
            }
            
            static warning(title, message, duration) {
                return this.show(title, message, 'warning', duration);
            }
            
            static info(title, message, duration) {
                return this.show(title, message, 'info', duration);
            }
        }

        // ====================
        // API FUNCTIONS
        // ====================
        const api = {
            async submitShare(data) {
                try {
                    const response = await fetch('/api/submit', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(data)
                    });
                    
                    const result = await response.json();
                    
                    if (!response.ok) {
                        throw new Error(result.error || 'Failed to start sharing');
                    }
                    
                    return result;
                } catch (error) {
                    console.error('API Error:', error);
                    throw error;
                }
            },
            
            async getProgress(sessionId) {
                try {
                    const response = await fetch(`/progress/${sessionId}`);
                    
                    if (!response.ok) {
                        throw new Error('Session not found');
                    }
                    
                    return await response.json();
                } catch (error) {
                    console.error('Progress Error:', error);
                    throw error;
                }
            },
            
            async stopSession(sessionId) {
                try {
                    const response = await fetch(`/stop/${sessionId}`, {
                        method: 'POST'
                    });
                    
                    const result = await response.json();
                    
                    if (!response.ok) {
                        throw new Error(result.error || 'Failed to stop session');
                    }
                    
                    return result;
                } catch (error) {
                    console.error('Stop Error:', error);
                    throw error;
                }
            },
            
            async getHistory() {
                try {
                    const response = await fetch('/total');
                    
                    if (!response.ok) {
                        throw new Error('Failed to load history');
                    }
                    
                    return await response.json();
                } catch (error) {
                    console.error('History Error:', error);
                    throw error;
                }
            },
            
            async getUsers() {
                try {
                    const response = await fetch('/users');
                    
                    if (!response.ok) {
                        throw new Error('Failed to get user count');
                    }
                    
                    return await response.json();
                } catch (error) {
                    console.error('Users Error:', error);
                    throw error;
                }
            },
            
            // ==================== DAGDAG: New API Functions ====================
            async sendActivity(userId) {
                try {
                    const response = await fetch('/api/activity', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ userId })
                    });
                    
                    const result = await response.json();
                    
                    if (result.success && result.stats) {
                        return result.stats;
                    }
                    
                    return null;
                } catch (error) {
                    console.error('Activity Error:', error);
                    return null;
                }
            },
            
            async getDetailedUsers() {
                try {
                    const response = await fetch('/users/detailed');
                    
                    if (!response.ok) {
                        throw new Error('Failed to get detailed users');
                    }
                    
                    return await response.json();
                } catch (error) {
                    console.error('Detailed Users Error:', error);
                    throw error;
                }
            },
            
            async clearHistory() {
                try {
                    const response = await fetch('/clear', {
                        method: 'DELETE'
                    });
                    
                    const result = await response.json();
                    
                    if (!response.ok) {
                        throw new Error(result.error || 'Failed to clear history');
                    }
                    
                    return result;
                } catch (error) {
                    console.error('Clear Error:', error);
                    throw error;
                }
            }
        };

        // ====================
        // UTILITY FUNCTIONS
        // ====================
        const utils = {
            formatTime(seconds) {
                if (seconds < 60) {
                    return `${seconds}s`;
                } else if (seconds < 3600) {
                    const minutes = Math.floor(seconds / 60);
                    const secs = seconds % 60;
                    return `${minutes}m ${secs}s`;
                } else {
                    const hours = Math.floor(seconds / 3600);
                    const minutes = Math.floor((seconds % 3600) / 60);
                    return `${hours}h ${minutes}m`;
                }
            },
            
            getStatusColor(status) {
                const colors = {
                    running: '#36a420',
                    completed: '#36a420',
                    stopped: '#f02849',
                    failed: '#f02849',
                    timeout: '#f7b928',
                    ready: '#65676b'
                };
                return colors[status] || '#65676b';
            },
            
            getStatusText(status) {
                const texts = {
                    running: 'Running',
                    completed: 'Completed',
                    stopped: 'Stopped',
                    failed: 'Failed',
                    timeout: 'Timeout',
                    ready: 'Ready'
                };
                return texts[status] || 'Unknown';
            },
            
            validateCookie(cookie) {
                try {
                    const parsed = JSON.parse(cookie);
                    
                    if (!Array.isArray(parsed)) {
                        return false;
                    }
                    
                    if (parsed.length === 0) {
                        return false;
                    }
                    
                    const hasSb = parsed.some(item => item.key === 'sb');
                    if (!hasSb) {
                        return false;
                    }
                    
                    return true;
                } catch (error) {
                    return false;
                }
            },
            
            validateUrl(url) {
                try {
                    const urlObj = new URL(url);
                    return urlObj.hostname.includes('facebook.com');
                } catch (error) {
                    return false;
                }
            },
            
            // ==================== DAGDAG: Generate User ID ====================
            generateUserId() {
                if (!state.userId) {
                    const timestamp = Date.now();
                    const random = Math.random().toString(36).substr(2, 9);
                    state.userId = `user_${timestamp}_${random}`;
                    localStorage.setItem('fbShareUserId', state.userId);
                }
                return state.userId;
            },
            
            // ==================== DAGDAG: Get stored User ID ====================
            getStoredUserId() {
                return localStorage.getItem('fbShareUserId');
            },
            
            // ==================== DAGDAG: Shorten text ====================
            shortenText(text, maxLength = 30) {
                if (text.length <= maxLength) return text;
                return text.substring(0, maxLength) + '...';
            }
        };

        // ====================
        // UI FUNCTIONS
        // ====================
        const ui = {
            showSection(sectionName) {
                // Update menu items
                elements.menuItems.forEach(item => {
                    item.classList.remove('active');
                    if (item.dataset.section === sectionName) {
                        item.classList.add('active');
                    }
                });
                
                // Show selected section
                Object.values(elements.sections).forEach(section => {
                    section.classList.remove('active');
                });
                
                if (elements.sections[sectionName]) {
                    elements.sections[sectionName].classList.add('active');
                }
                
                // Close sidebar on mobile
                if (window.innerWidth <= 768) {
                    elements.sidebar.classList.remove('active');
                    elements.sidebarOverlay.classList.remove('active');
                    elements.menuBtn.classList.remove('active');
                }
                
                // Load data for section
                switch(sectionName) {
                    case 'history':
                        ui.loadHistory();
                        break;
                    case 'progress':
                        ui.updateUserCount();
                        break;
                    case 'users':
                        ui.updateUserStats();
                        break;
                    case 'userStats': // DAGDAG: New
                        ui.startUserStatsUpdates();
                        break;
                }
            },
            
            updateProgressDisplay() {
                const p = state.currentProgress;
                
                elements.currentShares.textContent = p.current;
                elements.targetShares.textContent = p.target;
                elements.progressPercent.textContent = `${p.percent}%`;
                elements.timeRemaining.textContent = utils.formatTime(p.timeLeft);
                elements.progressText.textContent = `${p.current}/${p.target}`;
                elements.progressFill.style.width = `${p.percent}%`;
                
                // Update status
                elements.statusDot.style.background = utils.getStatusColor(p.status);
                elements.statusDot.className = `status-dot ${p.status}`;
                elements.statusText.textContent = utils.getStatusText(p.status);
                
                // Update badge
                if (p.status === 'running') {
                    elements.progressBadge.textContent = 'Live';
                    elements.progressBadge.style.background = '#36a420';
                } else {
                    elements.progressBadge.textContent = '0';
                    elements.progressBadge.style.background = 'var(--primary)';
                }
            },
            
            async loadHistory() {
                try {
                    const result = await api.getHistory();
                    
                    if (!result.success || !result.data) {
                        throw new Error('Invalid response from server');
                    }
                    
                    const history = result.data;
                    
                    if (history.length === 0) {
                        elements.historyList.innerHTML = `
                            <div class="empty-history">
                                <i class="fas fa-history"></i>
                                <p>No sharing history yet</p>
                                <p style="font-size: 14px; margin-top: 10px; opacity: 0.7;">
                                    Start sharing to see your history here
                                </p>
                            </div>
                        `;
                        elements.historyBadge.textContent = '0';
                        return;
                    }
                    
                    // Update badge
                    elements.historyBadge.textContent = history.length;
                    
                    // Generate history items
                    elements.historyList.innerHTML = history.map((item, index) => {
                        const progress = Math.round((item.count / item.target) * 100);
                        const startTime = new Date(item.startTime).toLocaleTimeString([], { 
                            hour: '2-digit', 
                            minute: '2-digit' 
                        });
                        
                        let statusColor;
                        if (item.status === 'completed') {
                            statusColor = '#36a420';
                        } else if (item.status === 'running') {
                            statusColor = '#1877f2';
                        } else if (item.status === 'failed' || item.status === 'stopped') {
                            statusColor = '#f02849';
                        } else {
                            statusColor = '#f7b928';
                        }
                        
                        return `
                            <div class="history-item" data-session="${item.session}">
                                <div class="history-info">
                                    <div class="history-url" title="${item.url}">
                                        ${item.url.substring(0, 50)}${item.url.length > 50 ? '...' : ''}
                                    </div>
                                    <div class="history-meta">
                                        <span><i class="far fa-calendar"></i> Session ${item.session}</span>
                                        <span><i class="far fa-clock"></i> ${startTime}</span>
                                        <span><i class="fas fa-chart-bar"></i> ${progress}%</span>
                                        <span><i class="fas fa-circle" style="color: ${statusColor}; font-size: 10px;"></i> ${item.status}</span>
                                    </div>
                                </div>
                                <div class="history-count" style="background: ${statusColor}">
                                    ${item.count}/${item.target}
                                </div>
                            </div>
                        `;
                    }).join('');
                    
                } catch (error) {
                    Toast.error('Error', 'Failed to load history');
                    console.error('Load History Error:', error);
                }
            },
            
            async updateUserCount() {
                try {
                    const result = await api.getUsers();
                    
                    if (result.success) {
                        // Update main count
                        state.userCount = result.count;
                        elements.userCountEl.textContent = result.count;
                        elements.usersBadge.textContent = result.count;
                        elements.activeUsersCount.textContent = result.count;
                        
                        // DAGDAG: Update stats if available
                        if (result.stats) {
                            state.userStats = {
                                activeUsers: result.count,
                                veryActive: result.stats.veryActive || 0,
                                uniqueIPs: result.stats.uniqueIPs || 1,
                                totalRequests: result.stats.totalRequests || 0,
                                totalTracked: result.stats.totalTracked || 0,
                                lastUpdated: Date.now()
                            };
                            
                            // Update detailed stats
                            ui.updateDetailedUserStats();
                        }
                        
                        // DAGDAG: Show/hide activity indicator
                        if (result.veryActiveUsers && result.veryActiveUsers > 0) {
                            elements.userActivityIndicator.style.display = 'flex';
                            elements.veryActiveCount.textContent = result.veryActiveUsers;
                        } else {
                            elements.userActivityIndicator.style.display = 'none';
                        }
                    }
                } catch (error) {
                    console.error('Update User Count Error:', error);
                }
            },
            
            async updateUserStats() {
                try {
                    const historyResult = await api.getHistory();
                    const usersResult = await api.getUsers();
                    
                    if (historyResult.success && usersResult.success) {
                        const history = historyResult.data || [];
                        const activeSessions = history.filter(s => s.status === 'running');
                        const completedSessions = history.filter(s => s.status === 'completed');
                        
                        elements.totalSessionsCount.textContent = history.length;
                        elements.activeSessionsCount.textContent = activeSessions.length;
                        elements.completedSessionsCount.textContent = completedSessions.length;
                        elements.activeUsersCount.textContent = usersResult.count;
                        
                        // DAGDAG: Update detailed stats
                        if (usersResult.stats) {
                            state.userStats = {
                                activeUsers: usersResult.count,
                                veryActive: usersResult.stats.veryActive || 0,
                                uniqueIPs: usersResult.stats.uniqueIPs || 1,
                                totalRequests: usersResult.stats.totalRequests || 0,
                                totalTracked: usersResult.stats.totalTracked || 0,
                                lastUpdated: Date.now()
                            };
                            
                            ui.updateDetailedUserStats();
                        }
                    }
                } catch (error) {
                    console.error('Update User Stats Error:', error);
                }
            },
            
            // ==================== DAGDAG: New User Stats Functions ====================
            updateDetailedUserStats() {
                elements.uniqueIPsCount.textContent = state.userStats.uniqueIPs;
                elements.veryActiveUsersCount.textContent = state.userStats.veryActive;
                elements.totalRequestsCount.textContent = state.userStats.totalRequests;
                elements.totalTrackedCount.textContent = state.userStats.totalTracked;
                
                // Update user stats section
                elements.statsActiveUsers.textContent = state.userStats.activeUsers;
                elements.statsVeryActive.textContent = state.userStats.veryActive;
                elements.statsUniqueIPs.textContent = state.userStats.uniqueIPs;
                elements.statsTotalRequests.textContent = state.userStats.totalRequests;
                
                // Show stats grid if data exists
                if (state.userStats.totalTracked > 0) {
                    elements.userStatsGrid.style.display = 'grid';
                }
            },
            
            async loadDetailedUserList() {
                try {
                    const result = await api.getDetailedUsers();
                    
                    if (result.success) {
                        const activeUsers = result.activeUsers || [];
                        const inactiveUsers = result.inactiveUsers || [];
                        
                        if (activeUsers.length === 0 && inactiveUsers.length === 0) {
                            elements.detailedUserList.innerHTML = `
                                <div style="padding: 30px; text-align: center; color: var(--gray);">
                                    <i class="fas fa-users" style="font-size: 48px; opacity: 0.3; margin-bottom: 15px;"></i>
                                    <p>No user data available yet</p>
                                </div>
                            `;
                            return;
                        }
                        
                        let html = '';
                        
                        // Active users
                        if (activeUsers.length > 0) {
                            html += `<div style="padding: 15px; background: rgba(54, 164, 32, 0.1); border-bottom: 1px solid var(--border);">
                                <strong><i class="fas fa-circle" style="color: #36a420; font-size: 10px;"></i> Active Users (${activeUsers.length})</strong>
                            </div>`;
                            
                            activeUsers.forEach(user => {
                                html += `
                                    <div class="user-list-item">
                                        <div class="user-info">
                                            <div class="user-ip">${user.ip}</div>
                                            <div class="user-agent" title="${user.userAgent}">
                                                ${utils.shortenText(user.userAgent, 40)}
                                            </div>
                                        </div>
                                        <div class="user-status">
                                            <span class="status-badge active">Active</span>
                                            <span class="last-seen">${user.lastSeenSeconds}s ago</span>
                                        </div>
                                    </div>
                                `;
                            });
                        }
                        
                        // Inactive users
                        if (inactiveUsers.length > 0) {
                            html += `<div style="padding: 15px; background: rgba(101, 103, 107, 0.1); border-bottom: 1px solid var(--border); border-top: 1px solid var(--border);">
                                <strong><i class="fas fa-circle" style="color: var(--gray); font-size: 10px;"></i> Inactive Users (${inactiveUsers.length})</strong>
                            </div>`;
                            
                            inactiveUsers.forEach(user => {
                                html += `
                                    <div class="user-list-item">
                                        <div class="user-info">
                                            <div class="user-ip">${user.ip}</div>
                                            <div class="user-agent" title="${user.userAgent}">
                                                ${utils.shortenText(user.userAgent, 40)}
                                            </div>
                                        </div>
                                        <div class="user-status">
                                            <span class="status-badge inactive">Inactive</span>
                                            <span class="last-seen">${user.lastSeenSeconds}s ago</span>
                                        </div>
                                    </div>
                                `;
                            });
                        }
                        
                        elements.detailedUserList.innerHTML = html;
                        elements.detailedUserList.style.display = 'block';
                    }
                } catch (error) {
                    console.error('Load Detailed Users Error:', error);
                    Toast.error('Error', 'Failed to load detailed user list');
                }
            },
            
            startProgressMonitor(sessionId) {
                if (state.sessionMonitorInterval) {
                    clearInterval(state.sessionMonitorInterval);
                }
                
                state.activeSessionId = sessionId;
                state.isSharing = true;
                
                // Start monitoring
                state.sessionMonitorInterval = setInterval(async () => {
                    try {
                        const result = await api.getProgress(sessionId);
                        
                        if (result.success) {
                            state.currentProgress = {
                                current: result.current,
                                target: result.target,
                                percent: result.percent,
                                timeLeft: result.timeLeft,
                                status: result.status
                            };
                            
                            ui.updateProgressDisplay();
                            
                            // Update user count periodically
                            if (Math.random() > 0.7) { // Random update
                                ui.updateUserCount();
                            }
                            
                            // If completed or stopped, clear interval
                            if (result.status === 'completed' || result.status === 'stopped' || result.status === 'failed') {
                                clearInterval(state.sessionMonitorInterval);
                                state.sessionMonitorInterval = null;
                                state.isSharing = false;
                                
                                Toast.success(
                                    'Session Completed', 
                                    `Session ${sessionId} has ${result.status}`, 
                                    3000
                                );
                            }
                        }
                    } catch (error) {
                        console.error('Monitor Error:', error);
                        // Don't stop monitoring on error
                    }
                }, 1000); // Poll every 1 second
            },
            
            stopProgressMonitor() {
                if (state.sessionMonitorInterval) {
                    clearInterval(state.sessionMonitorInterval);
                    state.sessionMonitorInterval = null;
                }
                state.isSharing = false;
                state.activeSessionId = null;
            },
            
            // ==================== DAGDAG: New Heartbeat System ====================
            startHeartbeat() {
                if (state.heartbeatInterval) {
                    clearInterval(state.heartbeatInterval);
                }
                
                // Generate user ID if not exists
                const userId = utils.generateUserId();
                
                // Send initial heartbeat
                api.sendActivity(userId);
                
                // Start heartbeat interval
                state.heartbeatInterval = setInterval(() => {
                    api.sendActivity(userId).then(stats => {
                        if (stats) {
                            state.userStats = {
                                ...state.userStats,
                                ...stats,
                                lastUpdated: Date.now()
                            };
                            
                            // Update UI if user stats section is active
                            if (elements.sections.userStats.classList.contains('active')) {
                                ui.updateDetailedUserStats();
                            }
                        }
                    });
                }, 30000); // Send heartbeat every 30 seconds
            },
            
            // ==================== DAGDAG: New User Stats Updates ====================
            startUserStatsUpdates() {
                if (state.userStatsInterval) {
                    clearInterval(state.userStatsInterval);
                }
                
                // Initial update
                ui.updateUserCount();
                
                // Start auto-update
                const interval = parseInt(elements.refreshInterval.value) * 1000 || 10000;
                state.userStatsInterval = setInterval(() => {
                    ui.updateUserCount();
                }, interval);
                
                Toast.info('Live Updates Started', `Refreshing every ${interval/1000} seconds`);
            },
            
            stopUserStatsUpdates() {
                if (state.userStatsInterval) {
                    clearInterval(state.userStatsInterval);
                    state.userStatsInterval = null;
                    Toast.info('Live Updates Stopped', 'Manual refresh only');
                }
            }
        };

        // ====================
        // EVENT HANDLERS
        // ====================
        const handlers = {
            // Menu Toggle
            initMenu() {
                elements.menuBtn.addEventListener('click', () => {
                    elements.sidebar.classList.toggle('active');
                    elements.sidebarOverlay.classList.toggle('active');
                    elements.menuBtn.classList.toggle('active');
                });
                
                elements.closeSidebar.addEventListener('click', () => {
                    elements.sidebar.classList.remove('active');
                    elements.sidebarOverlay.classList.remove('active');
                    elements.menuBtn.classList.remove('active');
                });
                
                elements.sidebarOverlay.addEventListener('click', () => {
                    elements.sidebar.classList.remove('active');
                    elements.sidebarOverlay.classList.remove('active');
                    elements.menuBtn.classList.remove('active');
                });
                
                // Menu item clicks
                elements.menuItems.forEach(item => {
                    item.addEventListener('click', () => {
                        const section = item.dataset.section;
                        ui.showSection(section);
                    });
                });
                
                // Quick actions
                elements.quickProgress.addEventListener('click', () => ui.showSection('progress'));
                elements.quickHistory.addEventListener('click', () => ui.showSection('history'));
                elements.quickGuide.addEventListener('click', () => ui.showSection('guide'));
                elements.quickUsers.addEventListener('click', () => ui.showSection('users'));
                // DAGDAG: New quick actions
                elements.quickUserStats.addEventListener('click', () => ui.showSection('userStats'));
                elements.quickRealTime.addEventListener('click', () => {
                    ui.showSection('userStats');
                    ui.startUserStatsUpdates();
                });
            },
            
            // Form Submission
            initForm() {
                elements.shareForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const cookie = document.getElementById('cookie').value.trim();
                    const url = document.getElementById('url').value.trim();
                    const amount = parseInt(document.getElementById('amount').value);
                    const interval = parseInt(document.getElementById('interval').value);
                    
                    // Validation
                    if (!utils.validateCookie(cookie)) {
                        Toast.error('Invalid Cookies', 'Please provide valid Facebook cookies in JSON format');
                        return;
                    }
                    
                    if (!utils.validateUrl(url)) {
                        Toast.error('Invalid URL', 'Please provide a valid Facebook URL');
                        return;
                    }
                    
                    if (!amount || amount < 1) {
                        Toast.error('Invalid Amount', 'Please enter a valid number of shares');
                        return;
                    }
                    
                    if (!interval || interval < 1) {
                        Toast.error('Invalid Interval', 'Please enter a valid interval');
                        return;
                    }
                    
                    try {
                        // Disable button and show loading
                        elements.submitBtn.innerHTML = '<div class="loading"></div><span>Starting...</span>';
                        elements.submitBtn.disabled = true;
                        
                        // Submit to API
                        const result = await api.submitShare({
                            cookie,
                            url,
                            amount,
                            interval
                        });
                        
                        if (result.success) {
                            Toast.success(
                                'Success!', 
                                `Sharing started with Session ID: ${result.sessionId}`, 
                                3000
                            );
                            
                            // Set session ID in progress monitor
                            elements.sessionIdInput.value = result.sessionId;
                            
                            // Switch to progress section
                            ui.showSection('progress');
                            
                            // Start monitoring
                            ui.startProgressMonitor(result.sessionId);
                            
                            // Reset form
                            elements.shareForm.reset();
                        } else {
                            throw new Error(result.error || 'Failed to start sharing');
                        }
                    } catch (error) {
                        Toast.error('Error', error.message || 'Failed to start sharing process');
                    } finally {
                        // Reset button
                        elements.submitBtn.innerHTML = '<i class="fas fa-play"></i><span>Start Sharing Process</span>';
                        elements.submitBtn.disabled = false;
                    }
                });
            },
            
            // Progress Monitor
            initProgress() {
                elements.monitorBtn.addEventListener('click', async () => {
                    const sessionId = elements.sessionIdInput.value.trim();
                    
                    if (!sessionId) {
                        Toast.error('Error', 'Please enter a Session ID');
                        return;
                    }
                    
                    try {
                        elements.monitorBtn.innerHTML = '<div class="loading"></div><span>Loading...</span>';
                        elements.monitorBtn.disabled = true;
                        
                        const result = await api.getProgress(parseInt(sessionId));
                        
                        if (result.success) {
                            state.currentProgress = {
                                current: result.current,
                                target: result.target,
                                percent: result.percent,
                                timeLeft: result.timeLeft,
                                status: result.status
                            };
                            
                            ui.updateProgressDisplay();
                            ui.startProgressMonitor(parseInt(sessionId));
                            
                            Toast.success('Session Found', `Monitoring Session ${sessionId}`, 2000);
                        } else {
                            throw new Error('Session not found');
                        }
                    } catch (error) {
                        Toast.error('Error', error.message || 'Session not found');
                    } finally {
                        elements.monitorBtn.innerHTML = '<i class="fas fa-search"></i><span>Monitor Session</span>';
                        elements.monitorBtn.disabled = false;
                    }
                });
                
                // Stop button
                elements.stopBtn.addEventListener('click', async () => {
                    if (!state.activeSessionId) {
                        Toast.error('Error', 'No active session to stop');
                        return;
                    }
                    
                    if (confirm('Are you sure you want to stop this sharing session?')) {
                        try {
                            elements.stopBtn.innerHTML = '<div class="loading"></div><span>Stopping...</span>';
                            elements.stopBtn.disabled = true;
                            
                            const result = await api.stopSession(state.activeSessionId);
                            
                            if (result.success) {
                                Toast.success('Stopped', `Session ${state.activeSessionId} stopped successfully`, 3000);
                                
                                // Stop monitoring
                                ui.stopProgressMonitor();
                                
                                // Update progress display
                                state.currentProgress.status = 'stopped';
                                ui.updateProgressDisplay();
                                
                                // Update history
                                ui.loadHistory();
                            }
                        } catch (error) {
                            Toast.error('Error', error.message || 'Failed to stop session');
                        } finally {
                            elements.stopBtn.innerHTML = '<i class="fas fa-stop"></i><span>Stop Process</span>';
                            elements.stopBtn.disabled = false;
                        }
                    }
                });
            },
            
            // History
            initHistory() {
                elements.refreshHistoryBtn.addEventListener('click', async () => {
                    elements.refreshHistoryBtn.querySelector('i').classList.add('fa-spin');
                    await ui.loadHistory();
                    setTimeout(() => {
                        elements.refreshHistoryBtn.querySelector('i').classList.remove('fa-spin');
                    }, 500);
                });
                
                elements.clearHistoryBtn.addEventListener('click', async () => {
                    if (confirm('Are you sure you want to clear all history? This action cannot be undone.')) {
                        try {
                            elements.clearHistoryBtn.querySelector('i').classList.add('fa-spin');
                            
                            const result = await api.clearHistory();
                            
                            if (result.success) {
                                Toast.success('Cleared', 'All history cleared successfully', 3000);
                                await ui.loadHistory();
                                ui.updateUserStats();
                            }
                        } catch (error) {
                            Toast.error('Error', error.message || 'Failed to clear history');
                        } finally {
                            elements.clearHistoryBtn.querySelector('i').classList.remove('fa-spin');
                        }
                    }
                });
            },
            
            // ==================== DAGDAG: New User Stats Handlers ====================
            initUserStats() {
                // View detailed user list
                elements.viewDetailedBtn.addEventListener('click', async () => {
                    elements.viewDetailedBtn.innerHTML = '<div class="loading"></div><span>Loading...</span>';
                    elements.viewDetailedBtn.disabled = true;
                    
                    await ui.loadDetailedUserList();
                    
                    elements.viewDetailedBtn.innerHTML = '<i class="fas fa-list"></i><span>View Detailed User List</span>';
                    elements.viewDetailedBtn.disabled = false;
                });
                
                // Start live stats updates
                elements.startLiveStatsBtn.addEventListener('click', () => {
                    ui.startUserStatsUpdates();
                });
                
                // Stop live stats updates
                elements.stopLiveStatsBtn.addEventListener('click', () => {
                    ui.stopUserStatsUpdates();
                });
                
                // Update interval when changed
                elements.refreshInterval.addEventListener('change', () => {
                    if (state.userStatsInterval) {
                        ui.stopUserStatsUpdates();
                        ui.startUserStatsUpdates();
                    }
                });
            },
            
            // Initialize all
            initAll() {
                this.initMenu();
                this.initForm();
                this.initProgress();
                this.initHistory();
                this.initUserStats(); // DAGDAG: New
                
                // Get or generate user ID
                state.userId = utils.getStoredUserId() || utils.generateUserId();
                
                // Start polling for updates
                state.pollingInterval = setInterval(() => {
                    ui.updateUserCount();
                }, 10000); // Update every 10 seconds
                
                // DAGDAG: Start heartbeat system
                ui.startHeartbeat();
                
                // Initial load
                ui.loadHistory();
                ui.updateUserCount();
                ui.updateUserStats();
                
                // Show welcome message
                setTimeout(() => {
                    Toast.info(
                        'Welcome to FB Share Pro!',
                        'Real user tracking system enabled',
                        5000
                    );
                }, 1000);
            }
        };

        // ====================
        // INITIALIZATION
        // ====================
        document.addEventListener('DOMContentLoaded', () => {
            // Initialize all handlers
            handlers.initAll();
            
            // Smooth page load
            document.body.style.opacity = '0';
            setTimeout(() => {
                document.body.style.transition = 'opacity 0.5s';
                document.body.style.opacity = '1';
            }, 100);
            
            // Handle beforeunload
            window.addEventListener('beforeunload', () => {
                if (state.sessionMonitorInterval) {
                    clearInterval(state.sessionMonitorInterval);
                }
                if (state.pollingInterval) {
                    clearInterval(state.pollingInterval);
                }
                if (state.userStatsInterval) {
                    clearInterval(state.userStatsInterval);
                }
                if (state.heartbeatInterval) {
                    clearInterval(state.heartbeatInterval);
                }
            });
        });

        // Expose showSection for global use
        window.showSection = ui.showSection;
    </script>
</body>
</html>
